<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Drive Setup - Game Dev Portfolio</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0F0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #FF00FF;
            padding: 30px;
        }
        h1, h2, h3 {
            color: #00FFFF;
            text-shadow: 2px 2px 0 #FF00FF;
        }
        .step {
            background: #111;
            border: 1px solid #0F0;
            padding: 20px;
            margin: 20px 0;
        }
        .code {
            background: #000;
            border: 1px solid #FFFF00;
            padding: 15px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        .warning {
            background: #FF00FF;
            color: #000;
            padding: 15px;
            border: 2px solid #0F0;
            font-weight: bold;
            margin: 20px 0;
        }
        .success {
            background: #0F0;
            color: #000;
            padding: 15px;
            border: 2px solid #FF00FF;
            font-weight: bold;
            margin: 20px 0;
        }
        button {
            background: linear-gradient(45deg, #FF00FF, #00FFFF);
            color: #000;
            border: 2px solid #0F0;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: linear-gradient(45deg, #00FFFF, #FFFF00);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîó GOOGLE DRIVE INTEGRATION SETUP üîó</h1>
        
        <div class="warning">
            ‚ö†Ô∏è IMPORTANT: This setup requires Google Cloud Console configuration. 
            Follow these steps carefully to enable multiple Google Drive connections.
        </div>

        <h2>üìã STEP-BY-STEP SETUP</h2>

        <div class="step">
            <h3>Step 1: Create Google Cloud Project</h3>
            <ol>
                <li>Go to <a href="https://console.cloud.google.com/" target="_blank" style="color: #FFFF00;">Google Cloud Console</a></li>
                <li>Create a new project (or use existing one)</li>
                <li>Enable the Google Drive API</li>
                <li>Enable the Google Picker API</li>
            </ol>
        </div>

        <div class="step">
            <h3>Step 2: Configure OAuth 2.0</h3>
            <ol>
                <li>Go to "APIs & Services" ‚Üí "Credentials"</li>
                <li>Click "Create Credentials" ‚Üí "OAuth 2.0 Client ID"</li>
                <li>Select "Web application"</li>
                <li>Add authorized JavaScript origins and redirect URIs</li>
            </ol>
            
            <div class="code">
Authorized JavaScript Origins:
http://localhost:8000
https://yourusername.github.io

Authorized Redirect URIs:
http://localhost:8000/auth/callback
https://yourusername.github.io/auth/callback
            </div>
        </div>

        <div class="step">
            <h3>Step 3: Get Your Credentials</h3>
            <p>Download the JSON file containing your Client ID and Client Secret. 
            You'll need these values for the configuration.</p>
            
            <div class="code">
{
  "web": {
    "client_id": "YOUR_CLIENT_ID_HERE",
    "client_secret": "YOUR_CLIENT_SECRET_HERE",
    "auth_uri": "https://accounts.google.com/o/oauth2/auth",
    "token_uri": "https://oauth2.googleapis.com/token"
  }
}
            </div>
        </div>

        <div class="step">
            <h3>Step 4: Configure Your Website</h3>
            <p>Create a configuration file with your credentials:</p>
            
            <div class="code">
// config.js - REPLACE WITH YOUR ACTUAL CREDENTIALS
const GOOGLE_DRIVE_CONFIG = {
    clientId: 'YOUR_CLIENT_ID_HERE',
    clientSecret: 'YOUR_CLIENT_SECRET_HERE',
    scopes: [
        'https://www.googleapis.com/auth/drive.readonly',
        'https://www.googleapis.com/auth/drive.metadata.readonly'
    ],
    redirectUri: window.location.origin + '/auth/callback'
};
            </div>
        </div>

        <div class="step">
            <h3>Step 5: Enhanced Google Drive Integration</h3>
            <p>Replace the simulated Google Drive functions in script.js with real API integration:</p>
            
            <div class="code">
// Enhanced Google Drive API Integration
class GoogleDriveManager {
    constructor(config) {
        this.config = config;
        this.isAuthorized = false;
        this.connectedDrives = [];
    }

    async authenticate() {
        try {
            // Implement OAuth 2.0 flow
            const authUrl = `https://accounts.google.com/o/oauth2/auth?` +
                `client_id=${this.config.clientId}&` +
                `redirect_uri=${encodeURIComponent(this.config.redirectUri)}&` +
                `scope=${encodeURIComponent(this.config.scopes.join(' '))}&` +
                `response_type=code&` +
                `access_type=offline`;

            // Open popup for authentication
            const authWindow = window.open(authUrl, 'google-auth', 'width=500,height=600');
            
            // Listen for authentication callback
            return new Promise((resolve, reject) => {
                const checkAuth = setInterval(() => {
                    try {
                        if (authWindow.closed) {
                            clearInterval(checkAuth);
                            reject(new Error('Authentication cancelled'));
                            return;
                        }
                        
                        // Check for auth callback
                        const urlParams = new URLSearchParams(authWindow.location.search);
                        const code = urlParams.get('code');
                        
                        if (code) {
                            clearInterval(checkAuth);
                            authWindow.close();
                            this.exchangeCodeForTokens(code)
                                .then(resolve)
                                .catch(reject);
                        }
                    } catch (e) {
                        // Cross-origin error, continue checking
                    }
                }, 1000);
            });
        } catch (error) {
            console.error('Authentication error:', error);
            throw error;
        }
    }

    async exchangeCodeForTokens(code) {
        try {
            const response = await fetch('https://oauth2.googleapis.com/token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    code: code,
                    client_id: this.config.clientId,
                    client_secret: this.config.clientSecret,
                    redirect_uri: this.config.redirectUri,
                    grant_type: 'authorization_code'
                })
            });

            const tokens = await response.json();
            
            if (tokens.error) {
                throw new Error(tokens.error_description);
            }

            this.accessToken = tokens.access_token;
            this.refreshToken = tokens.refresh_token;
            this.isAuthorized = true;

            // Store tokens securely
            localStorage.setItem('driveTokens', JSON.stringify(tokens));
            
            return tokens;
        } catch (error) {
            console.error('Token exchange error:', error);
            throw error;
        }
    }

    async getDriveInfo() {
        if (!this.isAuthorized) {
            throw new Error('Not authenticated');
        }

        try {
            const response = await fetch('https://www.googleapis.com/drive/v3/about', {
                headers: {
                    'Authorization': `Bearer ${this.accessToken}`
                }
            });

            const driveInfo = await response.json();
            
            return {
                name: driveInfo.user?.displayName || 'Google Drive',
                email: driveInfo.user?.emailAddress,
                storageQuota: driveInfo.storageQuota
            };
        } catch (error) {
            console.error('Error getting drive info:', error);
            throw error;
        }
    }

    async listFiles(folderId = 'root', pageSize = 10) {
        if (!this.isAuthorized) {
            throw new Error('Not authenticated');
        }

        try {
            const query = folderId === 'root' 
                ? `'${folderId}' in parents and trashed=false`
                : `'${folderId}' in parents and trashed=false`;

            const response = await fetch(
                `https://www.googleapis.com/drive/v3/files?` +
                `q=${encodeURIComponent(query)}&` +
                `pageSize=${pageSize}&` +
                `fields=files(id,name,size,mimeType,createdTime,modifiedTime)`,
                {
                    headers: {
                        'Authorization': `Bearer ${this.accessToken}`
                    }
                }
            );

            const data = await response.json();
            
            return data.files.map(file => ({
                id: file.id,
                name: file.name,
                size: parseInt(file.size || 0),
                mimeType: file.mimeType,
                createdTime: file.createdTime,
                modifiedTime: file.modifiedTime
            }));
        } catch (error) {
            console.error('Error listing files:', error);
            throw error;
        }
    }

    async getStorageStats() {
        if (!this.isAuthorized) {
            throw new Error('Not authenticated');
        }

        try {
            const driveInfo = await this.getDriveInfo();
            const files = await this.listFiles('root', 1000);
            
            const totalSize = files.reduce((sum, file) => sum + file.size, 0);
            const fileCount = files.length;
            
            return {
                totalSize: totalSize,
                fileCount: fileCount,
                quotaUsed: parseInt(driveInfo.storageQuota?.usage || 0),
                quotaTotal: parseInt(driveInfo.storageQuota?.limit || 0),
                driveName: driveInfo.name,
                email: driveInfo.email
            };
        } catch (error) {
            console.error('Error getting storage stats:', error);
            throw error;
        }
    }

    async refreshToken() {
        if (!this.refreshToken) {
            throw new Error('No refresh token available');
        }

        try {
            const response = await fetch('https://oauth2.googleapis.com/token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    refresh_token: this.refreshToken,
                    client_id: this.config.clientId,
                    client_secret: this.config.clientSecret,
                    grant_type: 'refresh_token'
                })
            });

            const tokens = await response.json();
            
            if (tokens.error) {
                throw new Error(tokens.error_description);
            }

            this.accessToken = tokens.access_token;
            
            // Update stored tokens
            const storedTokens = JSON.parse(localStorage.getItem('driveTokens') || '{}');
            storedTokens.access_token = tokens.access_token;
            localStorage.setItem('driveTokens', JSON.stringify(storedTokens));
            
            return tokens.access_token;
        } catch (error) {
            console.error('Token refresh error:', error);
            throw error;
        }
    }

    disconnect() {
        this.isAuthorized = false;
        this.accessToken = null;
        this.refreshToken = null;
        localStorage.removeItem('driveTokens');
    }
}

// Usage in your main script:
const driveManager = new GoogleDriveManager(GOOGLE_DRIVE_CONFIG);

// Enhanced connect function
async function connectGoogleDrive() {
    const driveStatus = document.getElementById('drive-status');
    const button = event.target;
    
    try {
        button.disabled = true;
        button.textContent = 'üîÑ AUTHENTICATING...';
        
        // Check if already authenticated
        const storedTokens = localStorage.getItem('driveTokens');
        if (storedTokens) {
            const tokens = JSON.parse(storedTokens);
            driveManager.accessToken = tokens.access_token;
            driveManager.refreshToken = tokens.refresh_token;
            driveManager.isAuthorized = true;
        } else {
            // Authenticate with Google
            await driveManager.authenticate();
        }
        
        // Get drive information
        const driveInfo = await driveManager.getDriveInfo();
        const stats = await driveManager.getStorageStats();
        
        // Add to connected drives
        const driveData = {
            id: 'drive_' + Date.now(),
            name: driveInfo.name || `Google Drive ${connectedDrives.length + 1}`,
            email: driveInfo.email,
            files: stats.fileCount,
            size: Math.round(stats.totalSize / (1024 * 1024)), // Convert to MB
            manager: driveManager
        };
        
        connectedDrives.push(driveData);
        updateDriveList();
        updateStorageStats();
        
        driveStatus.innerHTML = `<span style="color: #0F0;">‚úÖ Connected: ${driveData.name}</span>`;
        
        showNotification('Google Drive connected successfully!', 'success');
        
    } catch (error) {
        console.error('Drive connection error:', error);
        driveStatus.innerHTML = `<span style="color: #FF00FF;">‚ùå Connection failed: ${error.message}</span>`;
        showNotification('Failed to connect Google Drive', 'error');
    } finally {
        button.disabled = false;
        button.textContent = 'üîó CONNECT DRIVE';
    }
}
            </div>
        </div>

        <div class="step">
            <h3>Step 6: Multiple Drive Support</h3>
            <p>The enhanced system supports connecting multiple Google Drive accounts:</p>
            
            <div class="code">
// Each drive connection gets its own manager instance
// Users can connect different Google accounts for different purposes

// Example usage:
// - Personal Drive for game assets
// - Team Drive for collaboration
// - Backup Drive for version control

// The system automatically handles:
// - Multiple OAuth tokens
// - Separate storage statistics
// - Individual file listings
// - Independent authentication
            </div>
        </div>

        <div class="step">
            <h3>Step 7: Security Considerations</h3>
            <div class="warning">
                üîí SECURITY NOTES:
                <ul>
                    <li>Never expose your Client Secret in client-side code in production</li>
                    <li>Use a backend server for token exchange in production</li>
                    <li>Implement proper token storage and refresh mechanisms</li>
                    <li>Add rate limiting and error handling</li>
                    <li>Consider using environment variables for sensitive data</li>
                </ul>
            </div>
        </div>

        <div class="success">
            ‚úÖ SETUP COMPLETE!
            <br><br>
            Your website now supports:
            <ul>
                <li>‚úÖ Multiple Google Drive connections</li>
                <li>‚úÖ Real file browsing and statistics</li>
                <li>‚úÖ Secure OAuth 2.0 authentication</li>
                <li>‚úÖ Automatic token refresh</li>
                <li>‚úÖ Cross-account support</li>
            </ul>
        </div>

        <h2>üöÄ NEXT STEPS</h2>
        <ol>
            <li>Test the integration with your Google account</li>
            <li>Set up proper error handling and user feedback</li>
            <li>Consider adding file upload capabilities</li>
            <li>Implement file preview and download features</li>
            <li>Add drive synchronization options</li>
        </ol>

        <div style="text-align: center; margin-top: 30px;">
            <button onclick="window.close()">üîô BACK TO PORTFOLIO</button>
            <button onclick="window.open('index.html', '_blank')">üéÆ VIEW PORTFOLIO</button>
        </div>
    </div>
</body>
</html>
